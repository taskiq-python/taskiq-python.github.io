import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as u,c as r,e as l,w as a,b as s,d as n}from"./app-4a82c012.js";const k={},d=s("h1",{id:"middlewares",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#middlewares","aria-hidden":"true"},"#"),n(" Middlewares")],-1),m=s("p",null,"Middlewares are super helpful. You can inject some code before or after task's execution.",-1),b=s("p",null,[n("Middlewares must implement "),s("code",null,"taskiq.abc.middleware.TaskiqMiddleware"),n(" abstract class. Every method of a middleware can be either sync or async. Taskiq will execute it as you expect.")],-1),y=s("p",null,"For example:",-1),v=s("div",{class:"language-python line-numbers-mode","data-ext":"py"},[s("pre",{class:"language-python"},[s("code",null,[s("span",{class:"token keyword"},"from"),n(" time "),s("span",{class:"token keyword"},"import"),n(` sleep
`),s("span",{class:"token keyword"},"from"),n(" typing "),s("span",{class:"token keyword"},"import"),n(` Any

`),s("span",{class:"token keyword"},"from"),n(" taskiq "),s("span",{class:"token keyword"},"import"),n(" TaskiqMessage"),s("span",{class:"token punctuation"},","),n(" TaskiqMiddleware"),s("span",{class:"token punctuation"},","),n(` TaskiqResult


`),s("span",{class:"token keyword"},"class"),n(),s("span",{class:"token class-name"},"MyMiddleware"),s("span",{class:"token punctuation"},"("),n("TaskiqMiddleware"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},":"),n(`
    `),s("span",{class:"token keyword"},"def"),n(),s("span",{class:"token function"},"startup"),s("span",{class:"token punctuation"},"("),n("self"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"-"),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"None"),s("span",{class:"token punctuation"},":"),n(`
        `),s("span",{class:"token keyword"},"print"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'"RUN STARTUP"'),s("span",{class:"token punctuation"},")"),n(`
        sleep`),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),n(`

    `),s("span",{class:"token keyword"},"def"),n(),s("span",{class:"token function"},"shutdown"),s("span",{class:"token punctuation"},"("),n("self"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"-"),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"None"),s("span",{class:"token punctuation"},":"),n(`
        `),s("span",{class:"token keyword"},"print"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'"RUN SHUTDOWN"'),s("span",{class:"token punctuation"},")"),n(`
        sleep`),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),n(`

    `),s("span",{class:"token keyword"},"def"),n(),s("span",{class:"token function"},"pre_execute"),s("span",{class:"token punctuation"},"("),n("self"),s("span",{class:"token punctuation"},","),n(" message"),s("span",{class:"token punctuation"},":"),n(),s("span",{class:"token string"},'"TaskiqMessage"'),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"-"),s("span",{class:"token operator"},">"),n(" TaskiqMessage"),s("span",{class:"token punctuation"},":"),n(`
        sleep`),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),n(`
        `),s("span",{class:"token keyword"},"return"),n(` message

    `),s("span",{class:"token keyword"},"def"),n(),s("span",{class:"token function"},"post_save"),s("span",{class:"token punctuation"},"("),n("self"),s("span",{class:"token punctuation"},","),n(" message"),s("span",{class:"token punctuation"},":"),n(),s("span",{class:"token string"},'"TaskiqMessage"'),s("span",{class:"token punctuation"},","),n(" result"),s("span",{class:"token punctuation"},":"),n(),s("span",{class:"token string"},'"TaskiqResult[Any]"'),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"-"),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"None"),s("span",{class:"token punctuation"},":"),n(`
        sleep`),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),n(`
        `),s("span",{class:"token keyword"},"print"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'"Post save"'),s("span",{class:"token punctuation"},")"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),w=s("div",{class:"language-python line-numbers-mode","data-ext":"py"},[s("pre",{class:"language-python"},[s("code",null,[s("span",{class:"token keyword"},"from"),n(" asyncio "),s("span",{class:"token keyword"},"import"),n(` sleep
`),s("span",{class:"token keyword"},"from"),n(" typing "),s("span",{class:"token keyword"},"import"),n(` Any

`),s("span",{class:"token keyword"},"from"),n(" taskiq "),s("span",{class:"token keyword"},"import"),n(" TaskiqMessage"),s("span",{class:"token punctuation"},","),n(" TaskiqMiddleware"),s("span",{class:"token punctuation"},","),n(` TaskiqResult


`),s("span",{class:"token keyword"},"class"),n(),s("span",{class:"token class-name"},"MyMiddleware"),s("span",{class:"token punctuation"},"("),n("TaskiqMiddleware"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},":"),n(`
    `),s("span",{class:"token keyword"},"async"),n(),s("span",{class:"token keyword"},"def"),n(),s("span",{class:"token function"},"startup"),s("span",{class:"token punctuation"},"("),n("self"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"-"),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"None"),s("span",{class:"token punctuation"},":"),n(`
        `),s("span",{class:"token keyword"},"print"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'"RUN STARTUP"'),s("span",{class:"token punctuation"},")"),n(`
        `),s("span",{class:"token keyword"},"await"),n(" sleep"),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),n(`

    `),s("span",{class:"token keyword"},"async"),n(),s("span",{class:"token keyword"},"def"),n(),s("span",{class:"token function"},"shutdown"),s("span",{class:"token punctuation"},"("),n("self"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"-"),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"None"),s("span",{class:"token punctuation"},":"),n(`
        `),s("span",{class:"token keyword"},"print"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'"RUN SHUTDOWN"'),s("span",{class:"token punctuation"},")"),n(`
        `),s("span",{class:"token keyword"},"await"),n(" sleep"),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),n(`

    `),s("span",{class:"token keyword"},"async"),n(),s("span",{class:"token keyword"},"def"),n(),s("span",{class:"token function"},"pre_execute"),s("span",{class:"token punctuation"},"("),n("self"),s("span",{class:"token punctuation"},","),n(" message"),s("span",{class:"token punctuation"},":"),n(),s("span",{class:"token string"},'"TaskiqMessage"'),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"-"),s("span",{class:"token operator"},">"),n(" TaskiqMessage"),s("span",{class:"token punctuation"},":"),n(`
        `),s("span",{class:"token keyword"},"await"),n(" sleep"),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),n(`
        `),s("span",{class:"token keyword"},"return"),n(` message

    `),s("span",{class:"token keyword"},"async"),n(),s("span",{class:"token keyword"},"def"),n(),s("span",{class:"token function"},"post_save"),s("span",{class:"token punctuation"},"("),n(`
        self`),s("span",{class:"token punctuation"},","),n(`
        message`),s("span",{class:"token punctuation"},":"),n(),s("span",{class:"token string"},'"TaskiqMessage"'),s("span",{class:"token punctuation"},","),n(`
        result`),s("span",{class:"token punctuation"},":"),n(),s("span",{class:"token string"},'"TaskiqResult[Any]"'),s("span",{class:"token punctuation"},","),n(`
    `),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"-"),s("span",{class:"token operator"},">"),n(),s("span",{class:"token boolean"},"None"),s("span",{class:"token punctuation"},":"),n(`
        `),s("span",{class:"token keyword"},"await"),n(" sleep"),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),n(`
        `),s("span",{class:"token keyword"},"print"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},'"Post save"'),s("span",{class:"token punctuation"},")"),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),f=s("p",null,[n("Also, middlewares always have reference to the current broker in "),s("code",null,"self.broker"),n(" field. If you want to kick a message during the execution of some middleware hooks, you may use "),s("code",null,"self.broker"),n(" to do so.")],-1),g={href:"https://github.com/taskiq-python/taskiq-pipelines",target:"_blank",rel:"noopener noreferrer"};function _(h,T){const c=o("Tabs"),p=o("ExternalLinkIcon");return u(),r("div",null,[d,m,b,y,l(c,{id:"12",data:[{id:"sync"},{id:"async"}]},{title0:a(({value:e,isActive:t})=>[n("sync")]),title1:a(({value:e,isActive:t})=>[n("async")]),tab0:a(({value:e,isActive:t})=>[v]),tab1:a(({value:e,isActive:t})=>[w]),_:1}),f,s("p",null,[s("a",g,[n("Taskiq-pipelines"),l(p)]),n(" uses middlewares to call next tasks.")])])}const x=i(k,[["render",_],["__file","middleware.html.vue"]]);export{x as default};
