import{_ as r}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as k,c as d,e as o,w as a,b as n,d as s,a as l}from"./app-e5d0cce0.js";const m={},b=l('<h1 id="state-and-dependencies" tabindex="-1"><a class="header-anchor" href="#state-and-dependencies" aria-hidden="true">#</a> State and Dependencies</h1><h2 id="state" tabindex="-1"><a class="header-anchor" href="#state" aria-hidden="true">#</a> State</h2><p>The <code>TaskiqState</code> is a global variable where you can keep the variables you want to use later. For example, you want to open a database connection pool at a broker&#39;s startup.</p><p>This can be achieved by adding event handlers.</p><p>You can use one of these events:</p><ul><li><code>WORKER_STARTUP</code></li><li><code>CLIENT_STARTUP</code></li><li><code>WORKER_SHUTDOWN</code></li><li><code>CLIENT_SHUTDOWN</code></li></ul><p>Worker events are called when you start listening to the broker messages using taskiq. Client events are called when you call the <code>startup</code> method of your broker from your code.</p><p>This is an example of code using event handlers:</p>',8),v=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` asyncio
`),n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(" Annotated"),n("span",{class:"token punctuation"},","),s(` Optional

`),n("span",{class:"token keyword"},"from"),s(" redis"),n("span",{class:"token punctuation"},"."),s("asyncio "),n("span",{class:"token keyword"},"import"),s(" ConnectionPool"),n("span",{class:"token punctuation"},","),s(" Redis  "),n("span",{class:"token comment"},"# type: ignore"),s(`
`),n("span",{class:"token keyword"},"from"),s(" taskiq_aio_pika "),n("span",{class:"token keyword"},"import"),s(` AioPikaBroker
`),n("span",{class:"token keyword"},"from"),s(" taskiq_redis "),n("span",{class:"token keyword"},"import"),s(` RedisAsyncResultBackend

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(" Context"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},","),s(" TaskiqEvents"),n("span",{class:"token punctuation"},","),s(` TaskiqState

`),n("span",{class:"token comment"},"# To run this example, please install:"),s(`
`),n("span",{class:"token comment"},"# * taskiq"),s(`
`),n("span",{class:"token comment"},"# * taskiq-redis"),s(`
`),n("span",{class:"token comment"},"# * taskiq-aio-pika"),s(`

broker `),n("span",{class:"token operator"},"="),s(" AioPikaBroker"),n("span",{class:"token punctuation"},"("),s(`
    `),n("span",{class:"token string"},'"amqp://localhost"'),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("with_result_backend"),n("span",{class:"token punctuation"},"("),s("RedisAsyncResultBackend"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"redis://localhost"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("on_event")]),n("span",{class:"token punctuation"},"("),s("TaskiqEvents"),n("span",{class:"token punctuation"},"."),s("WORKER_STARTUP"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"startup"),n("span",{class:"token punctuation"},"("),s("state"),n("span",{class:"token punctuation"},":"),s(" TaskiqState"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Here we store connection pool on startup for later use."),s(`
    state`),n("span",{class:"token punctuation"},"."),s("redis "),n("span",{class:"token operator"},"="),s(" ConnectionPool"),n("span",{class:"token punctuation"},"."),s("from_url"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"redis://localhost/1"'),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("on_event")]),n("span",{class:"token punctuation"},"("),s("TaskiqEvents"),n("span",{class:"token punctuation"},"."),s("WORKER_SHUTDOWN"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"shutdown"),n("span",{class:"token punctuation"},"("),s("state"),n("span",{class:"token punctuation"},":"),s(" TaskiqState"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Here we close our pool on shutdown event."),s(`
    `),n("span",{class:"token keyword"},"await"),s(" state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},"."),s("disconnect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("task")]),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"get_val"),n("span",{class:"token punctuation"},"("),s(`
    key`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(`
    context`),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),s("Context"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" Optional"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Now we can use our pool."),s(`
    redis `),n("span",{class:"token operator"},"="),s(" Redis"),n("span",{class:"token punctuation"},"("),s("connection_pool"),n("span",{class:"token operator"},"="),s("context"),n("span",{class:"token punctuation"},"."),s("state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},","),s(" decode_responses"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"await"),s(" redis"),n("span",{class:"token punctuation"},"."),s("get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("task")]),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"set_val"),n("span",{class:"token punctuation"},"("),s(`
    key`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(`
    value`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(`
    context`),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),s("Context"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Now we can use our pool to set value."),s(`
    `),n("span",{class:"token keyword"},"await"),s(" Redis"),n("span",{class:"token punctuation"},"("),s("connection_pool"),n("span",{class:"token operator"},"="),s("context"),n("span",{class:"token punctuation"},"."),s("state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token builtin"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" broker"),n("span",{class:"token punctuation"},"."),s("startup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

    set_task `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" set_val"),n("span",{class:"token punctuation"},"."),s("kiq"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"key"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"value"'),n("span",{class:"token punctuation"},")"),s(`
    set_result `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" set_task"),n("span",{class:"token punctuation"},"."),s("wait_result"),n("span",{class:"token punctuation"},"("),s("with_logs"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"if"),s(" set_result"),n("span",{class:"token punctuation"},"."),s("is_err"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("set_result"),n("span",{class:"token punctuation"},"."),s("log"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token keyword"},"raise"),s(" ValueError"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Cannot set value in redis. See logs."'),n("span",{class:"token punctuation"},")"),s(`

    get_task `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" get_val"),n("span",{class:"token punctuation"},"."),s("kiq"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"key"'),n("span",{class:"token punctuation"},")"),s(`
    get_res `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" get_task"),n("span",{class:"token punctuation"},"."),s("wait_result"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-interpolation"},[n("span",{class:"token string"},'f"Got redis value: '),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),s("get_res"),n("span",{class:"token punctuation"},"."),s("return_value"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"await"),s(" broker"),n("span",{class:"token punctuation"},"."),s("shutdown"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"if"),s(" __name__ "),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token string"},'"__main__"'),n("span",{class:"token punctuation"},":"),s(`
    asyncio`),n("span",{class:"token punctuation"},"."),s("run"),n("span",{class:"token punctuation"},"("),s("main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),y=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` asyncio
`),n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` Optional

`),n("span",{class:"token keyword"},"from"),s(" redis"),n("span",{class:"token punctuation"},"."),s("asyncio "),n("span",{class:"token keyword"},"import"),s(" ConnectionPool"),n("span",{class:"token punctuation"},","),s(" Redis  "),n("span",{class:"token comment"},"# type: ignore"),s(`
`),n("span",{class:"token keyword"},"from"),s(" taskiq_aio_pika "),n("span",{class:"token keyword"},"import"),s(` AioPikaBroker
`),n("span",{class:"token keyword"},"from"),s(" taskiq_redis "),n("span",{class:"token keyword"},"import"),s(` RedisAsyncResultBackend

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(" Context"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},","),s(" TaskiqEvents"),n("span",{class:"token punctuation"},","),s(` TaskiqState

`),n("span",{class:"token comment"},"# To run this example, please install:"),s(`
`),n("span",{class:"token comment"},"# * taskiq"),s(`
`),n("span",{class:"token comment"},"# * taskiq-redis"),s(`
`),n("span",{class:"token comment"},"# * taskiq-aio-pika"),s(`

broker `),n("span",{class:"token operator"},"="),s(" AioPikaBroker"),n("span",{class:"token punctuation"},"("),s(`
    `),n("span",{class:"token string"},'"amqp://localhost"'),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("with_result_backend"),n("span",{class:"token punctuation"},"("),s("RedisAsyncResultBackend"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"redis://localhost"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("on_event")]),n("span",{class:"token punctuation"},"("),s("TaskiqEvents"),n("span",{class:"token punctuation"},"."),s("WORKER_STARTUP"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"startup"),n("span",{class:"token punctuation"},"("),s("state"),n("span",{class:"token punctuation"},":"),s(" TaskiqState"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Here we store connection pool on startup for later use."),s(`
    state`),n("span",{class:"token punctuation"},"."),s("redis "),n("span",{class:"token operator"},"="),s(" ConnectionPool"),n("span",{class:"token punctuation"},"."),s("from_url"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"redis://localhost/1"'),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("on_event")]),n("span",{class:"token punctuation"},"("),s("TaskiqEvents"),n("span",{class:"token punctuation"},"."),s("WORKER_SHUTDOWN"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"shutdown"),n("span",{class:"token punctuation"},"("),s("state"),n("span",{class:"token punctuation"},":"),s(" TaskiqState"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Here we close our pool on shutdown event."),s(`
    `),n("span",{class:"token keyword"},"await"),s(" state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},"."),s("disconnect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("task")]),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"get_val"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(" context"),n("span",{class:"token punctuation"},":"),s(" Context "),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" Optional"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Now we can use our pool."),s(`
    redis `),n("span",{class:"token operator"},"="),s(" Redis"),n("span",{class:"token punctuation"},"("),s("connection_pool"),n("span",{class:"token operator"},"="),s("context"),n("span",{class:"token punctuation"},"."),s("state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},","),s(" decode_responses"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"await"),s(" redis"),n("span",{class:"token punctuation"},"."),s("get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("task")]),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"set_val"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(" context"),n("span",{class:"token punctuation"},":"),s(" Context "),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Now we can use our pool to set value."),s(`
    `),n("span",{class:"token keyword"},"await"),s(" Redis"),n("span",{class:"token punctuation"},"("),s("connection_pool"),n("span",{class:"token operator"},"="),s("context"),n("span",{class:"token punctuation"},"."),s("state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token builtin"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" broker"),n("span",{class:"token punctuation"},"."),s("startup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

    set_task `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" set_val"),n("span",{class:"token punctuation"},"."),s("kiq"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"key"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"value"'),n("span",{class:"token punctuation"},")"),s(`
    set_result `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" set_task"),n("span",{class:"token punctuation"},"."),s("wait_result"),n("span",{class:"token punctuation"},"("),s("with_logs"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"if"),s(" set_result"),n("span",{class:"token punctuation"},"."),s("is_err"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("set_result"),n("span",{class:"token punctuation"},"."),s("log"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token keyword"},"raise"),s(" ValueError"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Cannot set value in redis. See logs."'),n("span",{class:"token punctuation"},")"),s(`

    get_task `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" get_val"),n("span",{class:"token punctuation"},"."),s("kiq"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"key"'),n("span",{class:"token punctuation"},")"),s(`
    get_res `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" get_task"),n("span",{class:"token punctuation"},"."),s("wait_result"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-interpolation"},[n("span",{class:"token string"},'f"Got redis value: '),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),s("get_res"),n("span",{class:"token punctuation"},"."),s("return_value"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"await"),s(" broker"),n("span",{class:"token punctuation"},"."),s("shutdown"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"if"),s(" __name__ "),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token string"},'"__main__"'),n("span",{class:"token punctuation"},":"),s(`
    asyncio`),n("span",{class:"token punctuation"},"."),s("run"),n("span",{class:"token punctuation"},"("),s("main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),w=n("div",{class:"hint-container tip"},[n("p",{class:"hint-container-title"},"Cool tip!"),n("p",null,[s("If you want to add handlers programmatically, you can use the "),n("code",null,"broker.add_event_handler"),s(" function.")])],-1),h=n("p",null,"As you can see in this example, this worker will initialize the Redis pool at the startup. You can access the state from the context.",-1),_=n("h2",{id:"dependencies",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#dependencies","aria-hidden":"true"},"#"),s(" Dependencies")],-1),f=n("p",null,"Using context directly is nice, but this way you won't get code-completion.",-1),g=n("p",null,"That's why we suggest you try TaskiqDependencies. The implementation is very similar to FastApi's dependencies. You can use classes, functions, and generators as dependencies.",-1),T={href:"https://pypi.org/project/taskiq-dependencies/",target:"_blank",rel:"noopener noreferrer"},A=l(`<h3 id="how-dependencies-are-useful" tabindex="-1"><a class="header-anchor" href="#how-dependencies-are-useful" aria-hidden="true">#</a> How dependencies are useful</h3><p>You can use dependencies for better autocompletion and reduce the amount of code you write. Since the state is generic, we cannot guess the types of the state fields. Dependencies can be annotated with type hints and therefore provide better auto-completion.</p><p>Let&#39;s assume that you&#39;ve stored a Redis connection pool in the state as in the example above.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token decorator annotation punctuation">@broker<span class="token punctuation">.</span>on_event</span><span class="token punctuation">(</span>TaskiqEvents<span class="token punctuation">.</span>WORKER_STARTUP<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">startup</span><span class="token punctuation">(</span>state<span class="token punctuation">:</span> TaskiqState<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token comment"># Here we store connection pool on startup for later use.</span>
    state<span class="token punctuation">.</span>redis <span class="token operator">=</span> ConnectionPool<span class="token punctuation">.</span>from_url<span class="token punctuation">(</span><span class="token string">&quot;redis://localhost/1&quot;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can access this variable by using the current execution context directly, like this:</p>`,5),q=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` Annotated

`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("task")]),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),s("Context"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"with"),s(" Redis"),n("span",{class:"token punctuation"},"("),s("connection_pool"),n("span",{class:"token operator"},"="),s("context"),n("span",{class:"token punctuation"},"."),s("state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},","),s(" decode_responses"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"as"),s(" redis"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"await"),s(" redis"),n("span",{class:"token punctuation"},"."),n("span",{class:"token builtin"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'key'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'value'"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),x=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("task")]),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},":"),s(" Context "),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"with"),s(" Redis"),n("span",{class:"token punctuation"},"("),s("connection_pool"),n("span",{class:"token operator"},"="),s("context"),n("span",{class:"token punctuation"},"."),s("state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},","),s(" decode_responses"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"as"),s(" redis"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"await"),s(" redis"),n("span",{class:"token punctuation"},"."),n("span",{class:"token builtin"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'key'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'value'"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),D=n("p",null,[s("If you hit the "),n("code",null,"TAB"),s(" button after the "),n("code",null,"context.state."),s(" expression, your IDE won't give you any auto-completion. But we can create a dependency function to add auto-completion.")],-1),N=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` Annotated

`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"redis_dep"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),s("Context"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" Redis"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" Redis"),n("span",{class:"token punctuation"},"("),s("connection_pool"),n("span",{class:"token operator"},"="),s("context"),n("span",{class:"token punctuation"},"."),s("state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},","),s(" decode_responses"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("task")]),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("redis"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),s("Redis"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("redis_dep"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" redis"),n("span",{class:"token punctuation"},"."),n("span",{class:"token builtin"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'key'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'value'"),n("span",{class:"token punctuation"},")"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),R=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[s(`
`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"redis_dep"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},":"),s(" Context "),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" Redis"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" Redis"),n("span",{class:"token punctuation"},"("),s("connection_pool"),n("span",{class:"token operator"},"="),s("context"),n("span",{class:"token punctuation"},"."),s("state"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},","),s(" decode_responses"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token decorator annotation punctuation"},[s("@broker"),n("span",{class:"token punctuation"},"."),s("task")]),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("redis"),n("span",{class:"token punctuation"},":"),s(" Redis "),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("redis_dep"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" redis"),n("span",{class:"token punctuation"},"."),n("span",{class:"token builtin"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'key'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'value'"),n("span",{class:"token punctuation"},")"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),S=n("p",null,"Now, this dependency injection will be autocompleted. But, of course, state fields cannot be autocompleted, even in dependencies. But this way, you won't make any typos while writing tasks.",-1),C=n("h3",{id:"how-do-dependencies-work",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#how-do-dependencies-work","aria-hidden":"true"},"#"),s(" How do dependencies work")],-1),E=n("p",null,[s("We build a graph of dependencies on startup. If the parameter of the function has the default value of "),n("code",null,"TaskiqDepends"),s(" this parameter will be treated as a dependency.")],-1),I=n("p",null,[s("Dependencies can also depend on something. Also dependencies are optimized to "),n("strong",null,"not"),s(" evaluate things many times.")],-1),B=n("p",null,"For example:",-1),G=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` random
`),n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` Annotated

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"common_dep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# For example it returns 8"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" random"),n("span",{class:"token punctuation"},"."),s("randint"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dep1"),n("span",{class:"token punctuation"},"("),s("cd"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("common_dep"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# This function will return 9"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" cd "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dep2"),n("span",{class:"token punctuation"},"("),s("cd"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("common_dep"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# This function will return 10"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" cd "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"2"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s(`
    d1`),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dep1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
    d2`),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dep2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# This function will return 19"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" d1 "),n("span",{class:"token operator"},"+"),s(` d2
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),O=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` random

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"common_dep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# For example it returns 8"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" random"),n("span",{class:"token punctuation"},"."),s("randint"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dep1"),n("span",{class:"token punctuation"},"("),s("cd"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"int"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("common_dep"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# This function will return 9"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" cd "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dep2"),n("span",{class:"token punctuation"},"("),s("cd"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"int"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("common_dep"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# This function will return 10"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" cd "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"2"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s(`
    d1`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"int"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dep1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
    d2`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"int"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dep2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# This function will return 19"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" d1 "),n("span",{class:"token operator"},"+"),s(` d2
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),H=l("<p>In this code, the dependency <code>common_dep</code> is going to be evaluated only once and the <code>dep1</code> and the <code>dep2</code> are going to receive the same value. You can control this behavior by using the <code>use_cache=False</code> parameter to you dependency. This parameter will force the dependency to reevaluate all it&#39;s subdependencies.</p><p>In this example we cannot predict the result. Since the <code>dep2</code> doesn&#39;t use cache for the <code>common_dep</code> function.</p>",2),W=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` random
`),n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` Annotated

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"common_dep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" random"),n("span",{class:"token punctuation"},"."),s("randint"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dep1"),n("span",{class:"token punctuation"},"("),s("cd"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("common_dep"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" cd "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dep2"),n("span",{class:"token punctuation"},"("),s("cd"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("common_dep"),n("span",{class:"token punctuation"},","),s(" use_cache"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"False"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" cd "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"2"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s(`
    d1`),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dep1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
    d2`),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dep2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" d1 "),n("span",{class:"token operator"},"+"),s(` d2
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),P=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` random

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"common_dep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" random"),n("span",{class:"token punctuation"},"."),s("randint"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dep1"),n("span",{class:"token punctuation"},"("),s("cd"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"int"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("common_dep"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" cd "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dep2"),n("span",{class:"token punctuation"},"("),s("cd"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"int"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("common_dep"),n("span",{class:"token punctuation"},","),s(" use_cache"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"False"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" cd "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"2"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s(`
    d1`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"int"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dep1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
    d2`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"int"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dep2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"int"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" d1 "),n("span",{class:"token operator"},"+"),s(` d2
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),L=n("p",null,"The graph for cached dependencies looks like this:",-1),U=n("p",null,[s("The dependencies graph for "),n("code",null,"my_task"),s(" where "),n("code",null,"dep2"),s(" doesn't use cached value for "),n("code",null,"common_dep"),s(" looks like this:")],-1),F=n("h3",{id:"class-as-a-dependency",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#class-as-a-dependency","aria-hidden":"true"},"#"),s(" Class as a dependency")],-1),Y=n("p",null,"You can use classes as dependencies, and they can also use other dependencies too.",-1),K=n("p",null,"Let's see an example:",-1),J=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` Annotated

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"db_connection"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token string"},`"let's pretend as this is a connection"`),s(`


`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"MyDAO"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"__init__"),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},","),s(" db_conn"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("db_connection"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
        self`),n("span",{class:"token punctuation"},"."),s("db_conn "),n("span",{class:"token operator"},"="),s(` db_conn

    `),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"get_users"),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" self"),n("span",{class:"token punctuation"},"."),s("db_conn"),n("span",{class:"token punctuation"},"."),s("upper"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("dao"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),s("MyDAO"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("dao"),n("span",{class:"token punctuation"},"."),s("get_users"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),M=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"db_connection"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token string"},`"let's pretend as this is a connection"`),s(`


`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"MyDAO"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"__init__"),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},","),s(" db_conn"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("db_connection"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
        self`),n("span",{class:"token punctuation"},"."),s("db_conn "),n("span",{class:"token operator"},"="),s(` db_conn

    `),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"get_users"),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" self"),n("span",{class:"token punctuation"},"."),s("db_conn"),n("span",{class:"token punctuation"},"."),s("upper"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("dao"),n("span",{class:"token punctuation"},":"),s(" MyDAO "),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("dao"),n("span",{class:"token punctuation"},"."),s("get_users"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),z=n("p",null,[s("As you can see, the dependency for "),n("code",null,"my_task"),s(" function is declared with "),n("code",null,"TaskiqDependency()"),s(". It's because you can omit the class if it's declared in type-hint for the parameter. This feature doesn't work with dependency functions, it's only for classes.")],-1),V=n("p",null,"You can pass dependencies for classes in the constructor.",-1),Q=n("h3",{id:"generator-dependencies",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#generator-dependencies","aria-hidden":"true"},"#"),s(" Generator dependencies")],-1),j=n("p",null,"Generator dependencies are used to perform startup before task execution and teardown after the task execution.",-1),Z=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(" Annotated"),n("span",{class:"token punctuation"},","),s(` Generator

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dependency"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" Generator"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Startup"'),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"yield"),s(),n("span",{class:"token string"},'"value"'),s(`

    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Shutdown"'),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("dep"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dependency"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("dep"),n("span",{class:"token punctuation"},"."),s("upper"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),X=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` Generator

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dependency"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" Generator"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Startup"'),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"yield"),s(),n("span",{class:"token string"},'"value"'),s(`

    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Shutdown"'),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("dep"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dependency"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("dep"),n("span",{class:"token punctuation"},"."),s("upper"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),$=n("p",null,"In this example, we can do something at startup before the execution and at shutdown after the task is completed.",-1),nn=n("p",null,"If you want to do something asynchronously, convert this function to an asynchronous generator. Like this:",-1),sn=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` asyncio
`),n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(" Annotated"),n("span",{class:"token punctuation"},","),s(` AsyncGenerator

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dependency"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" AsyncGenerator"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Startup"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" asyncio"),n("span",{class:"token punctuation"},"."),s("sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0.1"),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"yield"),s(),n("span",{class:"token string"},'"value"'),s(`

    `),n("span",{class:"token keyword"},"await"),s(" asyncio"),n("span",{class:"token punctuation"},"."),s("sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0.1"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Shutdown"'),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("dep"),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dependency"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("dep"),n("span",{class:"token punctuation"},"."),s("upper"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),an=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` asyncio
`),n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` AsyncGenerator

`),n("span",{class:"token keyword"},"from"),s(" taskiq "),n("span",{class:"token keyword"},"import"),s(` TaskiqDepends


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"dependency"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" AsyncGenerator"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Startup"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" asyncio"),n("span",{class:"token punctuation"},"."),s("sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0.1"),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"yield"),s(),n("span",{class:"token string"},'"value"'),s(`

    `),n("span",{class:"token keyword"},"await"),s(" asyncio"),n("span",{class:"token punctuation"},"."),s("sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0.1"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Shutdown"'),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"my_task"),n("span",{class:"token punctuation"},"("),s("dep"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),s(),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("dependency"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("dep"),n("span",{class:"token punctuation"},"."),s("upper"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),en=n("h4",{id:"exception-handling",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#exception-handling","aria-hidden":"true"},"#"),s(" Exception handling")],-1),tn=n("p",null,"Generator dependencies can handle exceptions that happen in tasks. This feature is handy if you want your system to be more atomic.",-1),on=n("p",null,"For example, if you open a database transaction in your dependency and want to commit it only if the function you execute is completed successfully.",-1),cn=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` Annotated

`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"get_transaction"),n("span",{class:"token punctuation"},"("),s(`
    db_driver`),n("span",{class:"token punctuation"},":"),s(" Annotated"),n("span",{class:"token punctuation"},"["),s("DBDriver"),n("span",{class:"token punctuation"},","),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("get_driver"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" AsyncGenerator"),n("span",{class:"token punctuation"},"["),s("Transaction"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    trans `),n("span",{class:"token operator"},"="),s(" db_driver"),n("span",{class:"token punctuation"},"."),s("begin_transaction"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"try"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token comment"},"# Here we give transaction to our dependant function."),s(`
        `),n("span",{class:"token keyword"},"yield"),s(` trans
    `),n("span",{class:"token comment"},"# If exception was found in dependant function,"),s(`
    `),n("span",{class:"token comment"},"# we rollback our transaction."),s(`
    `),n("span",{class:"token keyword"},"except"),s(" Exception"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"await"),s(" trans"),n("span",{class:"token punctuation"},"."),s("rollback"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token keyword"},"return"),s(`
    `),n("span",{class:"token comment"},"# Here we commit if everything is fine."),s(`
    `),n("span",{class:"token keyword"},"await"),s(" trans"),n("span",{class:"token punctuation"},"."),s("commit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),ln=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"get_transaction"),n("span",{class:"token punctuation"},"("),s(`
    db_driver`),n("span",{class:"token punctuation"},":"),s(" DBDriver "),n("span",{class:"token operator"},"="),s(" TaskiqDepends"),n("span",{class:"token punctuation"},"("),s("get_driver"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" AsyncGenerator"),n("span",{class:"token punctuation"},"["),s("Transaction"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    trans `),n("span",{class:"token operator"},"="),s(" db_driver"),n("span",{class:"token punctuation"},"."),s("begin_transaction"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"try"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token comment"},"# Here we give transaction to our dependant function."),s(`
        `),n("span",{class:"token keyword"},"yield"),s(` trans
    `),n("span",{class:"token comment"},"# If exception was found in dependant function,"),s(`
    `),n("span",{class:"token comment"},"# we rollback our transaction."),s(`
    `),n("span",{class:"token keyword"},"except"),s(" Exception"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"await"),s(" trans"),n("span",{class:"token punctuation"},"."),s("rollback"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token keyword"},"return"),s(`
    `),n("span",{class:"token comment"},"# Here we commit if everything is fine."),s(`
    `),n("span",{class:"token keyword"},"await"),s(" trans"),n("span",{class:"token punctuation"},"."),s("commit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),pn=l(`<p>If you don&#39;t want to propagate exceptions in dependencies, you can add <code>--no-propagate-errors</code> option to <code>worker</code> command.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>taskiq worker my_file:broker --no-propagate-errors
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>In this case, no exception will ever going to be propagated to any dependency.</p><h2 id="generics" tabindex="-1"><a class="header-anchor" href="#generics" aria-hidden="true">#</a> Generics</h2><p>Taskiq supports generic dependencies. You can create a generic class that is generic over another class and takskiq will be able to resolve generics based on type annotations.</p><h3 id="default-dependencies" tabindex="-1"><a class="header-anchor" href="#default-dependencies" aria-hidden="true">#</a> Default dependencies</h3><p>By default taskiq has only two dependencies:</p><ul><li>Context from <code>taskiq.context.Context</code></li><li>TaskiqState from <code>taskiq.state.TaskiqState</code></li></ul><h3 id="adding-first-level-dependencies" tabindex="-1"><a class="header-anchor" href="#adding-first-level-dependencies" aria-hidden="true">#</a> Adding first-level dependencies</h3><p>You can expand default list of available dependencies for you application. Taskiq have an ability to add new first-level dependencies using brokers.</p><p>The AsyncBroker interface has a function called <code>add_dependency_context</code> and you can add more default dependencies to the taskiq. This may be useful for libraries if you want to add new dependencies to users.</p>`,11);function un(rn,kn){const c=p("Tabs"),u=p("ExternalLinkIcon"),i=p("Mermaid");return k(),d("div",null,[b,o(c,{id:"43",data:[{id:"Annotated 3.10+"},{id:"default values"}]},{title0:a(({value:e,isActive:t})=>[s("Annotated 3.10+")]),title1:a(({value:e,isActive:t})=>[s("default values")]),tab0:a(({value:e,isActive:t})=>[v]),tab1:a(({value:e,isActive:t})=>[y]),_:1}),w,h,_,f,g,n("p",null,[s("We use the "),n("a",T,[s("taskiq-dependencies"),o(u)]),s(" package to provide autocompetion. You can easily integrate it in your own project.")]),A,o(c,{id:"84",data:[{id:"Annotated 3.10+"},{id:"default values"}]},{title0:a(({value:e,isActive:t})=>[s("Annotated 3.10+")]),title1:a(({value:e,isActive:t})=>[s("default values")]),tab0:a(({value:e,isActive:t})=>[q]),tab1:a(({value:e,isActive:t})=>[x]),_:1}),D,o(c,{id:"95",data:[{id:"Annotated 3.10+"},{id:"default values"}]},{title0:a(({value:e,isActive:t})=>[s("Annotated 3.10+")]),title1:a(({value:e,isActive:t})=>[s("default values")]),tab0:a(({value:e,isActive:t})=>[N]),tab1:a(({value:e,isActive:t})=>[R]),_:1}),S,C,E,I,B,o(c,{id:"118",data:[{id:"Annotated 3.10+"},{id:"default values"}]},{title0:a(({value:e,isActive:t})=>[s("Annotated 3.10+")]),title1:a(({value:e,isActive:t})=>[s("default values")]),tab0:a(({value:e,isActive:t})=>[G]),tab1:a(({value:e,isActive:t})=>[O]),_:1}),H,o(c,{id:"132",data:[{id:"Annotated 3.10+"},{id:"default values"}]},{title0:a(({value:e,isActive:t})=>[s("Annotated 3.10+")]),title1:a(({value:e,isActive:t})=>[s("default values")]),tab0:a(({value:e,isActive:t})=>[W]),tab1:a(({value:e,isActive:t})=>[P]),_:1}),L,o(i,{id:"mermaid-143",code:"eJxLL0osyFAIceFSAALH6OT83Nz8vPiU1IJYsIhTNJBpCGE7g9hGELZLdG5lfElicTaE66igq2un4ITEdoZoB7MhhjtD2QC8vBpx"}),U,o(i,{id:"mermaid-147",code:"eJxLL0osyFAIceFSAALH6OT83Nz8vPiU1IJYsIhTNJBpCGG7ROdWxpckFmdDuM4gKSMIu7g0CWJQeWZJRn5piUJyYnJGKlgKbK4hhsGpeSkQKxV0de0UnCBsQzDHGWIzmA1xlzOUDQCEcyvm"}),F,Y,K,o(c,{id:"157",data:[{id:"Annotated 3.10+"},{id:"default values"}]},{title0:a(({value:e,isActive:t})=>[s("Annotated 3.10+")]),title1:a(({value:e,isActive:t})=>[s("default values")]),tab0:a(({value:e,isActive:t})=>[J]),tab1:a(({value:e,isActive:t})=>[M]),_:1}),z,V,Q,j,o(c,{id:"177",data:[{id:"Annotated 3.10+"},{id:"default values"}]},{title0:a(({value:e,isActive:t})=>[s("Annotated 3.10+")]),title1:a(({value:e,isActive:t})=>[s("default values")]),tab0:a(({value:e,isActive:t})=>[Z]),tab1:a(({value:e,isActive:t})=>[X]),_:1}),$,nn,o(c,{id:"191",data:[{id:"Annotated 3.10+"},{id:"default values"}]},{title0:a(({value:e,isActive:t})=>[s("Annotated 3.10+")]),title1:a(({value:e,isActive:t})=>[s("default values")]),tab0:a(({value:e,isActive:t})=>[sn]),tab1:a(({value:e,isActive:t})=>[an]),_:1}),en,tn,on,o(c,{id:"208",data:[{id:"Annotated 3.10+"},{id:"default values"}]},{title0:a(({value:e,isActive:t})=>[s("Annotated 3.10+")]),title1:a(({value:e,isActive:t})=>[s("default values")]),tab0:a(({value:e,isActive:t})=>[cn]),tab1:a(({value:e,isActive:t})=>[ln]),_:1}),pn])}const bn=r(m,[["render",un],["__file","state-and-deps.html.vue"]]);export{bn as default};
